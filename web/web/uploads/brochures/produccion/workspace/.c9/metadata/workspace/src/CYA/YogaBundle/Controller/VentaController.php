{"changed":true,"filter":false,"title":"VentaController.php","tooltip":"/src/CYA/YogaBundle/Controller/VentaController.php","value":"<?php\n\nnamespace CYA\\YogaBundle\\Controller;\n\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\Controller;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Route;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\Validator\\Constraints as Assert;\nuse Symfony\\Component\\Form\\FormError;\nuse CYA\\YogaBundle\\Entity\\Tipoproducto;\nuse CYA\\YogaBundle\\Form\\TipoproductoType;\n\nclass VentaController extends Controller\n{\n    public function indexAction(Request $request)\n    {\n        $searchQuery = $request->get('query');\n\n        if(!empty($searchQuery)){\n            $finder = $this->container->get('fos_elastica.finder.app.tipoproducto');\n            $tipoproductos = $finder->createPaginatorAdapter($searchQuery);\n        }else{\n            $em = $this->getDoctrine()->getManager();\n            $dql = \"SELECT r FROM CYAYogaBundle:Tipoproducto r ORDER BY r.id DESC\";\n            $tipoproductos = $em->createQuery($dql);  \n        }\n\n        $paginator = $this->get('knp_paginator');\n        $pagination = $paginator->paginate(\n            $tipoproductos, $request->query->getInt('page' , 1),\n            10\n        );\n        \n        return $this->render('CYAYogaBundle:Tipoproducto:index.html.twig', array('pagination' => $pagination, 'tipoproductos' => $tipoproductos));\n    }\n    \n    public function addAction(Request $request)\n    {\n        $tipoproducto = new Tipoproducto();\n        \n        $form = $this->createForm(TipoproductoType::class, $tipoproducto);\n        $form->handleRequest($request);\n        \n        if ($form->isSubmitted() && $form->isValid()) {\n            \n                $em = $this->getDoctrine()->getManager();\n                $em->persist($tipoproducto);\n                $em->flush();\n                \n                $this->addFlash('mensaje', 'El tipo producto ha sido creado');\n                \n                return $this->redirectToRoute('cya_tipoproducto_index');\n        }\n      \n        return $this->render('CYAYogaBundle:Tipoproducto:add.html.twig', array('form' => $form->createView()));\n    }\n\n   public function editAction($id, Request $request)\n   {\n        $em = $this->getDoctrine()->getManager();\n        $tipoproducto = $em->getRepository('CYAYogaBundle:Tipoproducto')->find($id);\n        $form = $this->createForm(TipoproductoType::class, $tipoproducto);\n        $form->handleRequest($request); \n        \n        if(!$tipoproducto){\n            throw $this->createNotFoundException('Tipo producto no encontrado');\n        }\n       \n        if ($form->isSubmitted() && $form->isValid()) {\n            \n            $em->flush();\n            \n            $this->addFlash('mensaje', 'El tipo producto ha sido modificado');\n            \n            return $this->redirectToRoute('cya_tipoproducto_index');\n        }\n       \n        return $this->render('CYAYogaBundle:Tipoproducto:edit.html.twig', array('tipoproducto' => $tipoproducto, 'form' => $form->createView()));\n   }\n}\n","undoManager":{"mark":-2,"position":4,"stack":[[{"start":{"row":13,"column":6},"end":{"row":13,"column":18},"action":"remove","lines":["Tipoproducto"],"id":2},{"start":{"row":13,"column":6},"end":{"row":13,"column":7},"action":"insert","lines":["V"]}],[{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"insert","lines":["e"],"id":3}],[{"start":{"row":13,"column":8},"end":{"row":13,"column":9},"action":"insert","lines":["n"],"id":4}],[{"start":{"row":13,"column":9},"end":{"row":13,"column":10},"action":"insert","lines":["t"],"id":5}],[{"start":{"row":13,"column":10},"end":{"row":13,"column":11},"action":"insert","lines":["a"],"id":6}]]},"ace":{"folds":[],"scrolltop":120,"scrollleft":0,"selection":{"start":{"row":16,"column":5},"end":{"row":16,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":5,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1481290223044}